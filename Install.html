<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Install - Tezos-Community Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/marigold.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Tezos Community</a></li><li class="chapter-item expanded "><a href="USER.html"><strong aria-hidden="true">1.</strong> User Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Login.html"><strong aria-hidden="true">1.1.</strong> Login</a></li><li class="chapter-item expanded "><a href="CreateAnOrganization.html"><strong aria-hidden="true">1.2.</strong> Create an organization</a></li><li class="chapter-item expanded "><a href="ManageAnOrganization.html"><strong aria-hidden="true">1.3.</strong> Manage an organization</a></li><li class="chapter-item expanded "><a href="JoinAnOrganization.html"><strong aria-hidden="true">1.4.</strong> Join an organization</a></li><li class="chapter-item expanded "><a href="WriteToAnOrganization.html"><strong aria-hidden="true">1.5.</strong> Write to an organization</a></li></ol></li><li class="chapter-item expanded "><a href="DEVELOPER.html"><strong aria-hidden="true">2.</strong> Developer Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Incentive.html"><strong aria-hidden="true">2.1.</strong> Incentive</a></li><li class="chapter-item expanded "><a href="PreRequisites.html"><strong aria-hidden="true">2.2.</strong> PreRequisites</a></li><li class="chapter-item expanded "><a href="Install.html" class="active"><strong aria-hidden="true">2.3.</strong> Install</a></li><li class="chapter-item expanded "><a href="Example.html"><strong aria-hidden="true">2.4.</strong> Example</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Tezos-Community Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/marigold-dev/tezos-community" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="install"><a class="header" href="#install">Install</a></h1>
<p>Depending of your dapp technology, you can import 1,2 or the 3 libraries</p>
<pre><code class="language-bash">npm i @marigold-dev/tezos-community
npm i @marigold-dev/tezos-community-reactcontext
npm i @marigold-dev/tezos-community-reactcontext-ionic
</code></pre>
<p>Here below is described the full solution for Ionic React.</p>
<blockquote>
<p>You can start with the base library and adapt the code for an Angular context or Ionic Angular with no problem. If requested we could publish libraries for other web frameworks</p>
</blockquote>
<h2 id="set-environment-variables"><a class="header" href="#set-environment-variables">Set environment variables</a></h2>
<p>Library will search for 2 variables :</p>
<ul>
<li>VITE_TZCOMMUNITY_CONTRACT_ADDRESS : the TzCommunity deployed smartcontract</li>
<li>VITE_TZCOMMUNITY_BACKEND_URL :the TzCommunity backend API url</li>
</ul>
<p>Ghostnet</p>
<pre><code class="language-env">VITE_TZCOMMUNITY_CONTRACT_ADDRESS=KT1KpqE5kfor9fmoDTNMAjoKeLpKRv4ooEZw
VITE_TZCOMMUNITY_BACKEND_URL=https://back.tezos-community.gcp-npr.marigold.dev
</code></pre>
<p>Mainnet</p>
<pre><code class="language-env">VITE_TZCOMMUNITY_CONTRACT_ADDRESS=KT1D95aUDDfCQnh1Ay7riNaTDaWwX63dGY6X
VITE_TZCOMMUNITY_BACKEND_URL=https://back.tezos-community.gcp.marigold.dev
</code></pre>
<blockquote>
<p>These values might possibly change in the future, to be sure to use the correct configuation, contact <a href="mailto:support@marigold.dev">Marigold Team</a></p>
</blockquote>
<h2 id="connect--disconnect-to-tzcommunity-backend"><a class="header" href="#connect--disconnect-to-tzcommunity-backend">Connect / Disconnect to TzCommunity backend</a></h2>
<blockquote>
<p>TzCommunity uses <a href="https://siwt.xyz/">SIWT</a> to authentify to a web2 backend with your wallet
TzCommunity overrides default web local storage with Ionic one : <code>import { Storage as LocalStorage } from &quot;@ionic/storage&quot;;</code> . this way it works both for web and Ionic mobile app on native devices</p>
</blockquote>
<h3 id="connect-and-fetch-your-own-user-profile"><a class="header" href="#connect-and-fetch-your-own-user-profile">Connect and fetch your own user Profile</a></h3>
<p>Import libs</p>
<pre><code class="language-typescript">import {
  TzCommunityReactContext,
  TzCommunityReactContextType,
} from &quot;@marigold-dev/tezos-community-reactcontext&quot;;
import { address } from &quot;../type-aliases&quot;;
import { getUserProfile } from &quot;@marigold-dev/tezos-community&quot;;
</code></pre>
<p>Import the React context</p>
<pre><code class="language-typescript">const {
  setUserProfile,
  connectToWeb2Backend,
  localStorage,
  setUserProfiles,
  userProfiles,
} = React.useContext(TzCommunityReactContext) as TzCommunityReactContextType;
</code></pre>
<p>Connect to TzCommunity backend just after your logged with your wallet on Beacon. You can use <code>setUserProfile</code> to set your profile to a global context like below</p>
<pre><code class="language-typescript">const connectWallet = async (): Promise&lt;void&gt; =&gt; {

    ...

    try {
      await wallet.requestPermissions({
        network: {
          type: NetworkType[
            import.meta.env.VITE_NETWORK.toUpperCase() as keyof typeof NetworkType
          ],
          rpcUrl: import.meta.env.VITE_TEZOS_NODE,
        },
      });
      // gets user's address
      const userAddress = await wallet.getPKH();
      await setup(userAddress);

      //connect to TzCommunity
      await connectToWeb2Backend(
        wallet,
        userAddress,
        (
          await wallet.client.getActiveAccount()
        )?.publicKey!,
        localStorage
      );

      //try to load your user profile
      try {
        const newUserProfile = await getUserProfile(userAddress, localStorage);
        setUserProfile(newUserProfile!);

        setUserProfiles(
          userProfiles.set(userAddress as address, newUserProfile!)
        );
      } catch (error) {
        console.warn(
          &quot;User &quot; +
            userAddress +
            &quot; has no social account profile link on TzCommunity&quot;
        );
      }

</code></pre>
<h3 id="disconnect"><a class="header" href="#disconnect">Disconnect</a></h3>
<p>On your disconnect function, remove SIWT tokens from local storage</p>
<pre><code class="language-typescript">  const disconnectWallet = async (): Promise&lt;void&gt; =&gt; {

    //TzCommunity
    if (localStorage.initialized) {
      console.log(&quot;localStorage is initialized, removing access tokens&quot;);
      await localStorage.remove(LocalStorageKeys.access_token); //remove SIWT tokens
      await localStorage.remove(LocalStorageKeys.id_token); //remove SIWT tokens
      await localStorage.remove(LocalStorageKeys.refresh_token); //remove SIWT tokens
    } else {
      console.warn(&quot;localStorage not initialized, cannot remove access tokens&quot;);
    }
    //End TzCommunity
</code></pre>
<h2 id="on-apptsx-load-user-profiles-and-cache-results"><a class="header" href="#on-apptsx-load-user-profiles-and-cache-results">On App.tsx, Load user profiles, and cache results</a></h2>
<p>Initialize your local storage at Application startup</p>
<pre><code class="language-typescript">useEffect(() =&gt; {
  //TzCommunity
  (async () =&gt; {
    await localStorage.initStorage();
  })();
  //End TzCommunity
}, []);
</code></pre>
<p>Try to feth all user profile once you have connected</p>
<pre><code class="language-typescript">//tzCommunity
const [userProfiles, setUserProfiles] = useState&lt;Map&lt;address, UserProfile&gt;&gt;(
  new Map()
);

const [userProfile, setUserProfile] = useState&lt;UserProfile | undefined&gt;();
const [localStorage, setLocalStorage] = useState&lt;CachingService&gt;(
  new CachingService(new LocalStorage())
);

useEffect(() =&gt; {
  //only try to load if userProfile, it means you are logged with TzCommunity
  (async () =&gt; {
    if (userProfile || userProfile === null) {
      try {
        setUserProfiles(
          await loadUserProfiles(Tezos, userAddress!, localStorage)
        );
      } catch (error) {
        console.log(error);

        if (error instanceof TzCommunityError) {
          switch (error.type) {
            case TzCommunityErrorType.ACCESS_TOKEN_NULL: {
              console.warn(&quot;Cannot refresh token, disconnect&quot;);
              disconnectWallet();
              break;
            }
            case TzCommunityErrorType.ACCESS_TOKEN_EXPIRED: {
              console.warn(
                &quot;Access token expired, try to fetch from refresh token..&quot;
              );
              await refreshToken(userAddress!, localStorage);
              const userProfile = await getUserProfile(
                userAddress!,
                localStorage
              );
              if (userProfile) setUserProfile(userProfile);
              setUserProfiles(
                await loadUserProfiles(Tezos, userAddress!, localStorage)
              );
              break;
            }
          }
        } else {
          //nada
        }
      }
    } else {
      //nada
    }
  })();
}, [userProfile]);
</code></pre>
<p>Wrap your application with TzCommunity React context, so you can inject the context everywhere on your pages</p>
<pre><code class="language-typescript">return (
  &lt;IonApp&gt;
    &lt;TzCommunityReactContext.Provider
      value={{
        userProfiles,
        setUserProfiles,
        userProfile,
        setUserProfile,
        localStorage,
        connectToWeb2Backend: connectToWeb2Backend,
      }}
    &gt;
      ....
    &lt;/TzCommunityReactContext.Provider&gt;
  &lt;/IonApp&gt;
);
</code></pre>
<h3 id="in-case-of-hard-page-refresh-lost-of-session-and-you-want-to-reload-your-user-profile"><a class="header" href="#in-case-of-hard-page-refresh-lost-of-session-and-you-want-to-reload-your-user-profile">In case of HARD page refresh, lost of session and you want to reload your user profile</a></h3>
<pre><code class="language-typescript">const reloadUser = async (): Promise&lt;string | undefined&gt; =&gt; {

const activeAccount = await wallet.client.getActiveAccount();

if (activeAccount) {
    let userAddress = activeAccount!.address;
    setUserAddress(userAddress);

...

//try to load your user profile
try {
  const newUserProfile = await getUserProfile(userAddress, localStorage);
  setUserProfile(newUserProfile!);

  setUserProfiles(userProfiles.set(userAddress as address, newUserProfile!));
} catch (error) {
  if (error instanceof TzCommunityError) {
    switch (error.type) {
      case TzCommunityErrorType.ACCESS_TOKEN_NULL: {
        console.warn(&quot;Cannot refresh token, disconnect&quot;);
        disconnectWallet();
        break;
      }
      case TzCommunityErrorType.ACCESS_TOKEN_EXPIRED: {
        console.warn(&quot;Access token expired, try to fetch from refresh token..&quot;);
        await refreshToken(userAddress!, localStorage);
        const userProfile = await getUserProfile(userAddress!, localStorage);
        if (userProfile) setUserProfile(userProfile);
        setUserProfiles(
          await loadUserProfiles(Tezos, userAddress!, localStorage)
        );
        break;
      }
    }
  } else {
          console.warn(
            &quot;User &quot; +
              userAddress +
              &quot; has no social account profile link on TzCommunity&quot;
          );
        }
      }

      return userAddress;
    } else {
      return undefined;
    }
  };
</code></pre>
<h2 id="on-a-page-replace-tz1-display-on-your-ui-by-this-custom-ionchip"><a class="header" href="#on-a-page-replace-tz1-display-on-your-ui-by-this-custom-ionchip">On a Page, Replace tz1 display on your UI by this custom IonChip</a></h2>
<p>Import libs, fetch profiles from context and use the Chip component (replacing alice <code>tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb</code> address by your own variable)</p>
<pre><code class="language-typescript">import {
  TzCommunityReactContext,
  TzCommunityReactContextType,
} from &quot;@marigold-dev/tezos-community-reactcontext&quot;;
import { TzCommunityIonicUserProfileChip } from &quot;@marigold-dev/tezos-community-reactcontext-ionic&quot;;
import { address, int } from &quot;../type-aliases&quot;;

...


 //TZCOM CONTEXT
  const { userProfiles } = React.useContext(
    TzCommunityReactContext
  ) as TzCommunityReactContextType;

...

return  &lt;TzCommunityIonicUserProfileChip
                userProfiles={userProfiles}
                address=&quot;tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb&quot;
                key=&quot;tz1VSUr8wwNhLAzempoch5d6hLRiTh8Cjcjb&quot;
              &gt;&lt;/TzCommunityIonicUserProfileChip&gt;


</code></pre>
<p>Here is the end of the magic story</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="PreRequisites.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="Example.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="PreRequisites.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="Example.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="editor.js"></script>
        <script src="mode-rust.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/marigold.js"></script>


    </div>
    </body>
</html>
